-- -*- mode: lua; coding: windows-1251-dos -*-

--/ pda_fx.script /--
--/ PDA failure in blowout module /--
--/ OGS Evolution Team 2010 /--
--/ version 2.0 (18/04/2011) /--

--/ Модуль нерабочести PDA в выброс /--

function attach(sm)
	sm:subscribe({signal = "on_info",	fun = this.on_pda_info})
end

class "pda_control" (CUIScriptWnd)

function pda_control:__init() super()
	local xml = CScriptXmlInit()
	xml:ParseFile("pda.xml")
	self.bgnd = xml:InitStatic("background_fault", self) 
	self:Show(false)
end
function pda_control:AttachToPDA(pda_window)
	self.pda = pda_window
	pda_window:AttachChild(self)
end
function pda_control:__finalize()
	self.pda:DetachChild(self)
end

local pda_rec_wnd = pda_control()

function on_pda_info(npc, info_id)

	if (info_id == "ui_pda" and db.actor:has_info("no_net_signal")) or info_id == "no_net_signal" and db.actor:has_info("ui_pda") then
		if not pda_rec_wnd.pda then
			pda_rec_wnd:AttachToPDA(level.main_input_receiver())
		end
		if pda_rec_wnd.pda then
			pda_rec_wnd:Show(true)
		end
	elseif (info_id == "ui_pda" and db.actor:has_info("net_signal")) or info_id == "net_signal" and db.actor:has_info("ui_pda") then
		if pda_rec_wnd.pda then
			pda_rec_wnd:Show(false)
		end
	end

end
